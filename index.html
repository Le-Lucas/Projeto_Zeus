<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEUS_NOIR_V15_FIREBASE</title>
    <style>
        body { background-color: #0d0d0d; color: #b3b3b3; font-family: 'Courier New', Courier, monospace; margin: 0; padding: 0; overflow: hidden; }
        
        /* --- EFEITO SHIMMER --- */
        .shimmer-text {
            text-transform: uppercase;
            background: linear-gradient(to right, #444 20%, #ff0000 50%, #444 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: brilhoFluxo 4s linear infinite;
        }
        @keyframes brilhoFluxo { 0% { background-position: 200% center; } 100% { background-position: -200% center; } }

        /* --- ANIMAÇÃO DNA 3D --- */
        #dnaOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; display: block; }
        .dna-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 50px; perspective: 1000px; opacity: 0.15; }
        .dna-strand { display: flex; flex-direction: column; gap: 20px; animation: rotateDNA 6s linear infinite; transform-style: preserve-3d; }
        .dna-dot { width: 10px; height: 10px; background: #ff0000; border-radius: 50%; box-shadow: 0 0 15px #ff0000; }
        .strand-2 { animation-delay: -3s; }
        @keyframes rotateDNA { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
        .empty-state { position: absolute; top: 75%; left: 50%; transform: translate(-50%, -50%); color: #444; letter-spacing: 10px; font-size: 0.8rem; text-align: center; text-transform: uppercase; width: 100%; }

        /* --- INTERFACE --- */
        .menu-toggle { position: fixed; top: 20px; left: 20px; z-index: 2000; background: #800000; color: white; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; box-shadow: 3px 3px 0px #330000; }
        .sidebar { position: fixed; left: -280px; top: 0; width: 250px; height: 100%; background: rgba(5, 5, 5, 0.98); border-right: 2px solid #800000; z-index: 1500; transition: 0.4s; padding: 80px 20px 20px; backdrop-filter: blur(10px); }
        .sidebar.active { left: 0; }
        .sidebar-links div { color: #b3b3b3; padding: 12px 0; font-size: 0.9rem; transition: 0.3s; cursor: pointer; border-bottom: 1px solid #111; }
        .add-trigger { display: inline-block; margin-left: 15px; cursor: pointer; font-size: 1.8rem; color: #444; transition: 0.3s; vertical-align: middle; }
        .add-trigger:hover { color: #ff0000; text-shadow: 0 0 15px #ff0000; }

        /* --- CARDS --- */
        .carousel-vertical { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; scroll-behavior: smooth; position: relative; z-index: 10; }
        .carousel-vertical::-webkit-scrollbar { display: none; }
        .sessao-card { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; scroll-snap-align: start; transition: 0.8s; padding: 40px; box-sizing: border-box; text-align: center; position: relative; }
        .hidden { opacity: 0; transform: scale(0.95); filter: blur(10px); }
        .show { opacity: 1; transform: scale(1); filter: blur(0); }

        .card-controls { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .control-btn { cursor: pointer; font-size: 0.7rem; border: 1px solid #333; padding: 5px 10px; background: #000; color: #555; transition: 0.3s; }
        .control-btn:hover { border-color: #800000; color: #fff; }

        .img-container { width: 200px; height: 260px; border: 2px solid #800000; overflow: hidden; background: #000; filter: grayscale(100%) contrast(130%); }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }

        .resume-text { border-left: 3px solid #800000; padding: 15px; text-align: left; max-width: 650px; display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.6; background: rgba(255,255,255,0.02); margin: 20px 0; }
        .btn-access { background: none; border: 1px solid #800000; padding: 10px 20px; cursor: pointer; font-family: inherit; font-size: 0.9rem; transition: 0.3s; margin-top: 10px; color: #800000; }
        
        .sheet-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: left; width: 100%; max-width: 900px; margin-top: 10px; }
        .category-box { border: 1px solid #222; padding: 6px; background: rgba(255,255,255,0.01); }
        .category-box h4 { border-bottom: 1px solid #800000; color: #fff; font-size: 0.65rem; text-align: center; margin-bottom: 5px; }
        .stat-row { display: flex; justify-content: space-between; font-size: 0.7rem; }
        .dots { color: #800000; letter-spacing: 1px; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; z-index: 5000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); justify-content: center; align-items: center; }
        .modal-content { background: #0a0a0a; border: 1px solid #800000; padding: 25px; width: 90%; max-width: 900px; max-height: 85vh; overflow-y: auto; }
        input, textarea, select { background: #000; border: 1px solid #333; color: #fff; padding: 8px; width: 100%; margin-bottom: 5px; font-family: inherit; }
        .cmd-btn { background: #800000; color: white; border: none; padding: 10px; cursor: pointer; width: 100%; margin-top: 5px; }

        .ruido-estatico { position: fixed; top: -50%; left: -50%; width: 200%; height: 200%; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); opacity: 0.04; z-index: 9999; pointer-events: none; animation: estatica 0.2s infinite; }
        @keyframes estatica { 0%, 100% { transform: translate(0,0) } 50% { transform: translate(-1%, 1%) } }
    </style>
</head>
<body>

<div class="ruido-estatico"></div>
<div id="dnaOverlay"></div>

<button class="menu-toggle" onclick="toggleSidebar()">MENU</button>

<div class="sidebar" id="sidebar">
    <div style="color:#800000; font-size:1.1rem; margin-bottom:20px;">ZEUS_CORE_v15_FIRE</div>
    <div class="sidebar-links">
        <div onclick="changeCat('cronica')">> CRÔNICA</div>
        <div onclick="changeCat('personagens')">> PERSONAGENS</div>
        <div onclick="changeCat('projeto_zeus')">> PROJETO ZEUS</div>
        <div onclick="changeCat('figuras')">> FIGURAS NOTÁVEIS</div>
        <div onclick="changeCat('resistencia')">> A RESISTÊNCIA</div>
        <hr style="border-color:#222; margin: 20px 0;">
        <div onclick="clearCat()" style="font-size:0.7rem; opacity:0.4;">[ PURGAR_MEMÓRIA ]</div>
    </div>
</div>

<div style="text-align:center; padding: 15px; border-bottom: 1px solid #1a1a1a;">
    <h3 class="shimmer-text" id="displayTitle" style="font-size: 2rem; letter-spacing: 5px;">CRÔNICA</h3>
    <span class="add-trigger" onclick="openAddModal()">[ + ]</span>
</div>

<div class="carousel-vertical" id="chronicleFeed"></div>

<div id="ctxModal" class="modal">
    <div class="modal-content" id="modalBody"></div>
</div>

<div id="readModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" style="border-color: #ff0000;" onclick="event.stopPropagation()">
        <h2 id="readTitle" class="shimmer-text"></h2>
        <p id="readFullText" style="white-space: pre-wrap; font-size: 1.2rem; line-height: 1.5; color: #fff;"></p>
        <button class="cmd-btn" onclick="document.getElementById('readModal').style.display='none'">FECHAR</button>
    </div>
</div>

<script type="module">
    // --- FIREBASE CONFIG & INIT ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBpyI6-fn-w4IniDlVI0A1xEzyGn__iOTQ",
      authDomain: "projeto-zeus-a2f3e.firebaseapp.com",
      projectId: "projeto-zeus-a2f3e",
      storageBucket: "projeto-zeus-a2f3e.firebasestorage.app",
      messagingSenderId: "869815347699",
      appId: "1:869815347699:web:492f6278f9a7dde1858a86"
    };

    const app = initializeApp(firebaseConfig);
    const fs = getFirestore(app);

    // --- ESTADO GLOBAL ---
    window.currentCat = 'cronica';
    window.editingIdx = null;
    window.db = { cronica:[], personagens:[], projeto_zeus:[], figuras:[], resistencia:[] };
    let tempSkills = [], tempGear = [], tempTraits = [];

    // --- SINCRONIZAÇÃO EM TEMPO REAL ---
    const docRef = doc(fs, "sistema", "zeus_v15_data");
    onSnapshot(docRef, (docSnap) => {
        if (docSnap.exists()) {
            window.db = docSnap.data();
            render();
        } else {
            persist(); 
        }
    });

    async function persist() {
        await setDoc(doc(fs, "sistema", "zeus_v15_data"), window.db);
    }

    // --- FUNÇÕES DE UI ---
    window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');
    
    window.changeCat = (cat) => { 
        window.currentCat = cat; 
        document.getElementById('displayTitle').innerText = cat.replace('_', ' ').toUpperCase(); 
        render(); 
        window.toggleSidebar(); 
    };

    window.openAddModal = (idx = null) => {
        window.editingIdx = idx;
        const b = document.getElementById('modalBody');
        const item = idx !== null ? window.db[window.currentCat][idx] : null;

        if(window.currentCat === 'personagens') {
            tempSkills = item ? [...item.skills] : [];
            tempGear = item ? [...item.gear] : [];
            tempTraits = item ? [...item.traits] : [];
            b.innerHTML = `
                <h3 style="color:#800000">[ ${idx !== null ? 'EDITAR' : 'NOVO'} PJ ]</h3>
                <input type="text" id="cName" placeholder="NOME" value="${item ? item.name : ''}">
                <input type="text" id="cImg" placeholder="URL DA IMAGEM" value="${item ? item.img : ''}">
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                    <div><h5>ATRIBUTOS</h5>
                    FÍS: <input type="number" id="cFor" value="${item?item.phys.For:1}"> <input type="number" id="cDes" value="${item?item.phys.Des:1}"> <input type="number" id="cVig" value="${item?item.phys.Vig:1}"><br>
                    SOC: <input type="number" id="cCar" value="${item?item.soc.Car:1}"> <input type="number" id="cMan" value="${item?item.soc.Man:1}"> <input type="number" id="cApa" value="${item?item.soc.Apa:1}"><br>
                    MEN: <input type="number" id="cPer" value="${item?item.ment.Per:1}"> <input type="number" id="cInt" value="${item?item.ment.Int:1}"> <input type="number" id="cRac" value="${item?item.ment.Rac:1}"><br>
                    <h5>VIRTUDES / VITAIS</h5>
                    CON <input type="number" id="vCns" value="${item?item.virt.Con:1}"> AUT <input type="number" id="vAut" value="${item?item.virt.Aut:1}"> COR <input type="number" id="vCor" value="${item?item.virt.Cor:1}"><br>
                    HUM <input type="number" id="vHum" value="${item?item.vitals.Hum:7}"> VON <input type="number" id="vVon" value="${item?item.vitals.Will:5}"> CRP <input type="number" id="vCrp" value="${item?item.vitals.Cor:0}">
                    </div>
                    <div><h5>HABILIDADES / ITENS</h5>
                    <input type="text" id="iName" placeholder="Nome">
                    <input type="number" id="iVal" value="1" max="5">
                    <select id="iType"><option value="skill">Habilidade</option><option value="gear">Equipamento</option><option value="trait">Vant/Def</option></select>
                    <button id="btnAddTemp" class="cmd-btn">ADD</button></div>
                    <div id="previewList" style="font-size:0.6rem; border:1px dashed #333; padding:5px; height:180px; overflow-y:auto;">${tempSkills.length + tempGear.length + tempTraits.length} itens registrados.</div>
                </div><button class="cmd-btn" id="btnSaveChar">GRAVAR</button><button class="cmd-btn" style="background:#222" onclick="closeModal()">CANCELAR</button>`;
            
            document.getElementById('btnAddTemp').onclick = addToTemp;
            document.getElementById('btnSaveChar').onclick = saveCharacter;
        } else {
            b.innerHTML = `<h3>[ ${idx !== null ? 'EDITAR' : 'NOVO'} ]</h3><input type="text" id="gTitle" placeholder="TÍTULO" value="${item?item.title:''}"><input type="text" id="gImg" placeholder="URL IMAGEM" value="${item?(item.img||''):''}"><textarea id="gText" rows="12">${item?item.text:''}</textarea><button class="cmd-btn" id="btnSaveGen">SINCRONIZAR</button>`;
            document.getElementById('btnSaveGen').onclick = saveGeneral;
        }
        document.getElementById('ctxModal').style.display = 'flex';
    };

    function addToTemp() {
        const n = document.getElementById('iName').value, v = document.getElementById('iVal').value, t = document.getElementById('iType').value;
        if(n) { 
            if(t === 'skill') tempSkills.push({n, v}); else if(t === 'gear') tempGear.push({n, v}); else tempTraits.push({n, v});
            document.getElementById('previewList').innerHTML = `${tempSkills.length + tempGear.length + tempTraits.length} itens registrados.`; 
            document.getElementById('iName').value = ''; 
        }
    }

    function saveCharacter() {
        const data = { name: document.getElementById('cName').value || 'NULO', img: document.getElementById('cImg').value || '', phys: { For: document.getElementById('cFor').value, Des: document.getElementById('cDes').value, Vig: document.getElementById('cVig').value }, soc: { Car: document.getElementById('cCar').value, Man: document.getElementById('cMan').value, Apa: document.getElementById('cApa').value }, ment: { Per: document.getElementById('cPer').value, Int: document.getElementById('cInt').value, Rac: document.getElementById('cRac').value }, virt: { Con: document.getElementById('vCns').value, Aut: document.getElementById('vAut').value, Cor: document.getElementById('vCor').value }, vitals: { Hum: document.getElementById('vHum').value, Will: document.getElementById('vVon').value, Cor: document.getElementById('vCrp').value }, skills: tempSkills, gear: tempGear, traits: tempTraits };
        if(window.editingIdx !== null) window.db.personagens[window.editingIdx] = data; else window.db.personagens.push(data);
        persist();
        window.closeModal();
    }

    function saveGeneral() {
        const data = { title: document.getElementById('gTitle').value, text: document.getElementById('gText').value, img: document.getElementById('gImg').value || '', date: new Date().toLocaleDateString() };
        if(window.editingIdx !== null) window.db[window.currentCat][window.editingIdx] = data; else window.db[window.currentCat].push(data);
        persist();
        window.closeModal();
    }

    window.deleteItem = (idx) => { if(confirm("Purgar registro?")) { window.db[window.currentCat].splice(idx, 1); persist(); } };
    window.closeModal = () => { document.getElementById('ctxModal').style.display = 'none'; };
    window.clearCat = () => { if(confirm("Purgar arquivos desta aba?")) { window.db[window.currentCat] = []; persist(); } };

    // --- RENDERIZAÇÃO ---
    const getDots = (n, max=5) => "●".repeat(n) + "○".repeat(max - n);
    const obs = new IntersectionObserver((es) => es.forEach(e => e.target.classList.toggle('show', e.isIntersecting)), { threshold: 0.4 });

    function render() {
        const f = document.getElementById('chronicleFeed'); f.innerHTML = '';
        const data = window.db[window.currentCat] || [];
        const dna = document.getElementById('dnaOverlay');

        if (data.length === 0) { 
            dna.style.display = 'block'; 
            createDNA(); 
        } else { 
            dna.style.display = 'none'; 
        }

        data.forEach((item, i) => {
            const card = document.createElement('div'); card.className = 'sessao-card hidden';
            const controls = `<div class="card-controls"><div class="control-btn" onclick="openAddModal(${i})">EDIT</div><div class="control-btn" style="color:red" onclick="deleteItem(${i})">X</div></div>`;
            
            if(window.currentCat === 'personagens') {
                card.innerHTML = `${controls}<div style="display:flex; gap:20px; width:100%; max-width:950px; align-items:start;"><div class="img-container"><img src="${item.img || 'https://via.placeholder.com/200'}"></div><div style="flex:1;"><h2 class="shimmer-text" style="font-size:1.8rem; text-align:left;">${item.name}</h2><div class="sheet-grid"><div class="category-box"><h4>FÍSICOS</h4>${Object.entries(item.phys).map(([k,v])=>`<div class="stat-row"><span>${k}</span><span class="dots">${getDots(v)}</span></div>`).join('')}</div><div class="category-box"><h4>SOCIAIS</h4>${Object.entries(item.soc).map(([k,v])=>`<div class="stat-row"><span>${k}</span><span class="dots">${getDots(v)}</span></div>`).join('')}</div><div class="category-box"><h4>MENTAIS</h4>${Object.entries(item.ment).map(([k,v])=>`<div class="stat-row"><span>${k}</span><span class="dots">${getDots(v)}</span></div>`).join('')}</div></div><div class="sheet-grid" style="margin-top:5px;"><div class="category-box"><h4>VIRTUDES</h4>${Object.entries(item.virt).map(([k,v])=>`<div class="stat-row"><span>${k}</span><span class="dots">${getDots(v)}</span></div>`).join('')}</div><div class="category-box" style="grid-column: span 2;"><h4>MÉTRICAS</h4><div class="stat-row"><span>HUMANIDADE</span><span class="dots">${getDots(item.vitals.Hum, 10)}</span></div><div class="stat-row"><span>VONTADE</span><span class="dots">${getDots(item.vitals.Will, 10)}</span> | <span style="color:red">CORRUPÇÃO</span><span class="dots">${getDots(item.vitals.Cor, 10)}</span></div></div></div></div></div><div class="sheet-grid" style="width:100%; max-width:950px; margin-top:5px;"><div class="category-box"><h4>HABILIDADES</h4>${item.skills.map(s=>`<div class="stat-row"><span>${s.n}</span><span class="dots">${getDots(s.v)}</span></div>`).join('')}</div><div class="category-box"><h4>ITENS</h4>${item.gear.map(g=>`<div class="stat-row"><span>${g.n}</span><span class="dots">${getDots(g.v
